# Генератор CDR и UDR

Проект реализует генератор отчетов по звонкам, который эмулирует работу коммутатора сотового оператора. Он генерирует CDR записи и на их основе создает UDR отчеты.

## Описание задач

### Задача 1: Генерация CDR файлов

Написать сервис, который генерирует CDR файлы по заданным условиям.

#### Условия:
- 1 CDR = 1 месяц.
- Тарифицируемый период - 1 год.
- Данные в CDR идут не по порядку.
- Количество и длительность звонков определяются случайным образом.
- Список абонентов (не менее 10) хранится в локальной БД (H2).
- Данные о транзакциях пользователя помещаются в соседнюю таблицу БД.

### Задача 2: Генерация UDR отчетов

Передать данные от CDR сервиса в сервис генерации UDR. Агрегировать данные по каждому абоненту в отчет.

#### Условия:
- Данные берутся только из CDR файла.
- Сгенерированные объекты отчета размещаются в /reports.
- Шаблон имени: номер_месяц.json (например, 79876543221_1.json).
- Класс генератора содержит методы для генерации отчетов:
    - generateReport(): сохраняет все отчеты и выводит в консоль таблицу со всеми абонентами и итоговым временем звонков по всему тарифицируемому периоду каждого абонента.
    - generateReport(msisdn): сохраняет все отчеты и выводит в консоль таблицу по одному абоненту и его итоговому времени звонков в каждом месяце.
    - generateReport(msisdn, month): сохраняет отчет и выводит в консоль таблицу по одному абоненту и его итоговому времени звонков в указанном месяце.

## Инструменты

- OpenJDK 17
- Gradle
- JUnit 5

## Глоссарий

- CDR (Call Data Record) – формат файла, содержащего информацию о действиях абонента за тарифицируемый период.
- UDR (Usage Data Report) - Отчет об использовании данных.
- MSISDN (Mobile Subscriber Integrated Services Digital Number) - номер мобильного абонента цифровой сети.

## Решение

### Основные компоненты
1. **CdrGenerator**: Класс, отвечающий за генерацию CDR записей для всех абонентов или для конкретного абонента.
2. **SystemManager**: Класс, управляющий базой данных и генерацией отчетов. Включает в себя методы для чтения CDR записей из базы данных, сохранения CDR в файлы, а также для сохранения UDR отчетов.
3. **UdrGenerator**: Класс, который использует данные CDR записей для генерации UDR отчетов. Также предоставляет методы для генерации отчетов для всех абонентов, для конкретного абонента и для определенного месяца.

### Взаимодействие
1. **CdrGenerator** получает список абонентов из базы данных через **SystemManager** и генерирует для каждого из них CDR записи. Затем сохраняет их в файлы через тот же **SystemManager**.
2. **UdrGenerator** использует CDR записи, прочитанные из базы данных через **SystemManager**, для создания UDR отчетов. Затем сохраняет эти отчеты и выводит таблицу с агрегированными данными.

### Модели данных
1. **Cdr**: Представляет CDR запись с информацией о типе вызова, номере абонента и времени начала и окончания вызова.
2. **Udr**: Модель данных для представления UDR записи с информацией о номере абонента и общей длительности входящих и исходящих звонков.

### Дополнительный функционал
1. **DurationCalculator**: Класс-сервис, используемый для вычисления длительности звонков и их суммирования.

